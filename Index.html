<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تطبيقي</title>

  <!-- أيقونة أساسية -->
  <link rel="icon" type="image/png" sizes="192x192"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAABHNCSVQICAgIfAhkiAAAACJJREFUeJ7twQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAADwLOsAAQGBtM0AAAAASUVORK5CYII=">

  <!-- ميتا PWA -->
  <meta name="theme-color" content="#317EFB"/>

  <!-- manifest داخل الصفحة -->
  <script type="application/ld+json" id="manifest-placeholder">
  {
    "name": "تطبيقي",
    "short_name": "تطبيق",
    "start_url": ".",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#317EFB",
    "description": "تطبيق ويب تجريبي لتجربة التحويل إلى APK من الهاتف فقط.",
    "icons": [
      {
        "src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAABHNCSVQICAgIfAhkiAAAACJJREFUeJ7twQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAADwLOsAAQGBtM0AAAAASUVORK5CYII=",
        "sizes": "192x192",
        "type": "image/png"
      }
    ]
  }
  </script>

  <script>
    // يخلي المتصفح يشوف المانيفست من داخل الصفحة
    const manifest = document.getElementById('manifest-placeholder').textContent;
    const blob = new Blob([manifest], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(blob);
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = manifestURL;
    document.head.appendChild(link);
  </script>
</head>
<body>
  <h1>مرحبا بك 👋</h1>
  <p>هذا اختبار PWA بملف واحد فقط مع وصف داخل manifest.</p>

  <script>
    // تسجيل service worker داخل نفس الملف
    if ('serviceWorker' in navigator) {
      const swCode = `
        self.addEventListener('install', e => {
          console.log('Service Worker: Installed');
          e.waitUntil(self.skipWaiting());
        });
        self.addEventListener('activate', e => {
          console.log('Service Worker: Active');
          return self.clients.claim();
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swURL = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swURL);
    }
  </script>
</body>
</html>
